## 本地仓库----->gitee思想

## 动态传参的两种方法

```
//第一种如下：他会将变量的类型更改为字符串=>更改变量类型
this.$http.get("users/${变量}" + )
//第二种如下：不会影响变量的类型
this.$http.get("users/" + 变量)
```



## 一、前端项目初始化步骤

![image-20220328161111665](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328161111665.png)

### 1、安装vue脚手架

安装全局脚手架，安装一次就可

### 2、通过vue脚手架创建项目---ui，通过可视化面板创建项目

（1）终端：

![image-20220328161354810](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328161354810.png)

（2）选择项目文件夹存放路径-------点击在此创建新项目

![image-20220328161447079](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328161447079.png)

项目命名

![image-20220328161525472](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328161525472.png)

重新创建预设，或者使用已规定的预设

![image-20220328162240670](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328162240670.png)

### 3、配置vue路由---安装路由等

![](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328161802594.png

![image-20220328162140395](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328162140395.png)

![image-20220328162154185](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328162154185.png)

创建项目![image-20220328162656595](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328162656595.png)

### 4、配置Element-UI组件库

（1）安装插件

![image-20220328163616174](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328163616174.png)

![image-20220328163834630](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328163834630.png)

（2）配置插件

![image-20220328164021589](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328164021589.png)

### 5、配置axios库---支持项目中发起网络数据请求

![image-20220328165246240](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328165246240.png)



![image-20220328165436016](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328165436016.png)

或者终端：vue add axios

### 6、初始化git远程仓库

![image-20220328174112337](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328174112337.png)

怎么样生成公钥（终端）：(1)ssh-keygen -t ed25519 -C "账号邮箱"           (2)打开公钥文件-将内容复制到文本框中

![image-20220328174326652](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328174326652.png)

（3）首次使用需要确认并添加主机到本机SSH可信列表：ssh -T git@gitee.com

![SSH添加提示](https://images.gitee.com/uploads/images/2018/0814/170837_4c5ef029_551147.png)

### 7、将本地项目托管到GitHub或者gitee中

（1）创建仓库

![image-20220328174924400](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328174924400.png)

（2）按照规则继续

![image-20220328175244525](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328175244525.png)

注：如果已经有vue项目选择第二种方式，否则第一种。这里已经创建了vue项目，选择第二种方式

（4）

**本地操作仓库**：

打开项目目录---在路径位置输入powershell

![image-20220328180453645](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328180453645.png)

输入命令： git status---git add .(空格，将所有文件添加到暂存区)---git commit -m "add files"---git status

![image-20220328180700715](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328180700715.png)

​                                                                                                   成功时界面

**将仓库添加到码云**：

git remote add origin https://gitee.com/yang_dongyun/vue_shop.git    ---    git push -u origin "master"（本地仓库与云端仓库关联）

## 二、后端项目的环境配置

![image-20220328182224191](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328182224191.png)

### 1、安装MySQL数据库

（1）安装phpstudy(网上搜索安装

（2）导入数据库---支持api接口运行

![image-20220328234736638](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220328234736638.png)

**注意：数据库名称要与数据库表名相同；把vue_api_server\config下的default.json里的user: root, password: root,改成你在phpstudy_por创建数据库任务栏的用户名和密码**

（3）对创建的数据库：操作---导入---vue_api_server\vue_api_server\db下的mydb.sql

### 2+3+4

vue_api_server下的文件就是后台api项目，需要安装依赖包才可以运行

（1）以**管理员**打开powershell

（2）cd "vue_api_server文件目录"

（3）npm install---安装所有的依赖项

（4）node ./app.js---运行api接口项目

**注意：这一步进行后不要关闭，否则下一步将报错**

### 5、使用postman测试后台项目接口是否正常

（1）安装postman

（2）打开项目接口文档

（3）token：登录状态保存（服务端与客户端）

![image-20220329000821278](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220329000821278.png)

## 三、登录与退出功能

![image-20220329002306745](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220329002306745.png)

### 1、登录-token原理

![image-20220329002817462](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220329002817462.png)

### 2、终端操作：

（1）查看工作区是否干净：打开项目，首先在终端输入git status

![image-20220331164909528](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220331164909528.png)

（2）创建分支login并切换到该分支：git checkout -b login(一个分支代表一个功能)

![image-20220331165341471](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220331165341471.png)

（3）查看当前项目中所有分支：git branch

![image-20220331165651602](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220331165651602.png)

### 3、删除不需要的组件

（1）清理根组件的内容（2）删除views文件夹（3）删除components文件夹下的组件

   最终得到干净的项目

### 4、创建登录组件

（1）在components文件夹下创建Login.vue组件，写入组件的基本结构（结构-行为-样式）

![image-20220331183430927](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220331183430927.png)

（2）通过路由渲染组件

![image-20220331183803490](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220331183803490.png)

（3）在根组件中为登录组件占位

![image-20220331183924053](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220331183924053.png)

（4）为组件写入样式

由于vue-ui可视化创建项目时不会安装less-loader与less，所以需要自己安装，步骤如下：

​      1、打开ui面板（此项目）-依赖-安装依赖

​      2、![image-20220331184314735](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220331184314735.png)

​    		注意:由于less-loader与less一直在更新，目前位置版本过高，已不适用此项目，所以需要在项目**终端**中手动安装指定版本less@3 和less-loader@7 搭配（npm install less@3    npm install less-loader@7）

​	3、创建全局样式表

​		在src-assets文件夹下创建global.css**全局样式表**，写入（注意：需要在程序入口处中导入全局样式import './assets/global.css'）

```
html,
body,
#app {
    height: 100%;
    padding: 0;
    margin: 0;
}		
```

​		在**组件样式**中写入：

```
.login_container {
  height: 100%;
  background-color: #2b4b6b;
}
```

​		最终呈现登录界面背景色铺满全屏

### 6、思路

![image-20220401143608328](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220401143608328.png)

**绘制整个盒子**

**编程式导航（路由）**：路径为/时，重定向为登陆路径

**用户名与密码**：(1)双向数据绑定，“：model”指令对象的属性分别为用户名与密码

```
 <el-form :model="loginForm">
 
       loginForm: {
        username: "admin",
        password: "123456",
      }
      
 <el-input
            prefix-icon="el-icon-key"//密码前的图标
            v-model="loginForm.password"
            type="password"
            ></el-input>
  
```

 (2)Form表单验证:只需要通过 `rules` 属性传入约定的验证规则，并将 **Form-Item** 的 `prop` 属性设置为需校验的字段名即可。

```
 <!-- 登录表单 -->
      <el-form
        ref="loginFormRef"
        :rules="loginFormRules"
      >
      //`rules` 属性传入约定的验证规则是对象，对象内的属性为数组--对象
       loginFormRules: {
        //   注意：这里规则的命名要与loginForm的属性名相同
        username: [
          { required: true, message: "请输入用户名", trigger: "blur" },
          {
            min: 3,
            max: 10,
            message: "长度在 3 到 10 个字符",
            trigger: "blur",
          },
        ]}
        
          <!-- 用户名 -->
        <el-form-item prop="username">
          <el-input
            v-model="loginForm.username"
            prefix-icon="el-icon-user"
          ></el-input>
        </el-form-item>
```

总结：首先所有的属性、规则全部单向绑定给el-form表单，最后把对应的属性（双向）数据绑定给各自的el-input或el-form-item

**重置按钮**：获取表单对象---通过表单对象的方法重置表当

```
  //   重置按钮
    reset() {
      this.$refs["loginFormRef"].resetFields();
    },
```

**登录按钮**：通过表当对象对整个表单数据验证---处理服务端返回的数据（判断是否存在该用户）---将登录成功之后的 token，保存到客户端的 sessionStorage（存储会话期间的地址）---从登陆页面跳转到其他页面（编程式导航this.$router） 

```
   login() {
      this.$refs["loginFormRef"].validate(async (value) => {
        if (!value) return;
        const { data: res } = await this.$http.post("login", this.loginForm);
        if (res.meta.status !== 200) return this.$message.error("用户不存在");
        this.$message.success("登录成功");
        // 1. 将登录成功之后的 token，保存到客户端的 sessionStorage（存储会话期间的地址） 中
        //   1.1 项目中 除了登录之外的其他API接口，必须在登录之后才能访问
        //   1.2 token 只应在当前网站打开期间生效，所以将 token 保存在 sessionStorage 中
        window.sessionStorage.setItem("token", res.data.token);
        // 2. 通过编程式导航跳转到后台主页，路由地址是 /home
        this.$router.push("/home");
      });
    }
```

**防止用户通过指定url访问特定的页面**：路由守卫

```
// 为路由挂载路由导航守卫
router.beforeEach((to, from, next) => {
  // to表示将要访问的路径
  // from表示从那个路径跳转而来
  // next是一个函数，表示放行，next('/home')表示强制跳转
  if (to.path === '/login') next();
  const a = window.sessionStorage.getItem('token');
  if (!a) next('/login');
  next()
})
```

**登录成功后的退出按钮**：清除sessionStorage中的数据--- 通过编程式导航跳转到登录页面

```
  quit() {
      window.sessionStorage.clear();
      this.$router.push("/login");
    }
```

### 5、将本地仓库的登录页面代码提交到gitee

在项目中打开终端---git status(查看修改、添加的文件)---git add .(将文件添加到缓存区)---git branch（查看当前所在分支，确定是否将文件添加到该分支上，如果不是，则通过git checkout 分支名 切换分支）---git commit - m "描述"（将本地文件添加到该分支）---git checkout master（切换到master分支）---git merge 分支名  （将分支内容保存在master分支中）---git push（把本地仓库中的master分支内容推送到码云）

注意：gitee中只有一个master分支，如果要**在gitee中添加分支**，需要通过以下行为：在项目终端中（1）git checkout 分支名（切换到本地仓库分支，在gitee中没有该分支）（2）git branch  （查看是否为要添加的分支）（3）git push -u origin login（将本地分支推送到云端origin仓中，同时命名为login分支）

## 四、主页布局

![image-20220401155304322](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220401155304322.png)

**NavMenu 导航菜单**：为网站提供导航功能的菜单。

![image-20220401163131725](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220401163131725.png)

### 1、需要授权的 API ，必须在请求头中使用 `Authorization` 字段提供 `token` 令牌

![image-20220401172201442](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220401172201442.png)

```
axios.interceptors.request.use(config => {
  // console.log(config)
  //为请求头对象，添加token验证的Authorization字段
  config.headers.Authorization = window.sessionStorage.getItem('token')
  // 在最后必须 return config
  return config
})
```

注意：登录请求不需要授权，所以登陆后，Authorization中的值为Null

### 2、获取左侧菜单

当主页面加载时，就应立即获取左侧菜单栏，所以需要created生命周期函数

```
 created() {
    this.getMenuList();
  }
// 获取所有的菜单
    async getMenuList() {
      const { data: res } = await this.$http.get("menus");
      if (res.meta.status !== 200) return this.$message.error(res.meta.msg);
      //data中的menulist属性接收data菜单数据
      this.menuList = res.data;
      console.log(res);
    },
```

#### 1、渲染菜单

由于有二级菜单，所以需要嵌套渲染

#### 2、优化一级、二级菜单图标

![image-20220401191508060](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220401191508060.png)

一级菜单图标不同：每一个一级菜单都对应一个图标（key-value),所以将图标存在对象中，属性名为对应菜单的唯一id，这样每一个一级菜单的图标可以通过对象的不同属性名（唯一id）得到

```
   <!-- 一级菜单 -->
          <el-submenu
            :index="item.id + ''"
            v-for="item in menuList"
            :key="item.id"
          >
<!-- 一级菜单模板区域 -->
            <template slot="title">
              <i :class="iconsObj[item.id]"></i>
              <!-- 一级菜单名称 -->
              <span>{{ item.authName }}</span>
            </template>
iconsObj: {
        125: "iconfont icon-user",
        103: "iconfont icon-tijikongjian",
        101: "iconfont icon-shangpin",
        102: "iconfont icon-danju",
        145: "iconfont icon-baobiao",
      }
```

二级菜单图标相同：

#### 3、一次只能打开一个菜单项以及让菜单的边框线对齐

只能打开一个菜单项:

**Menu Attribute**

| 参数          | 说明                       | 类型    | 可选值 | 默认值 |
| :------------ | :------------------------- | :------ | :----- | :----- |
| unique-opened | 是否只保持一个子菜单的展开 | boolean | —      | false  |

```
 <el-menu background-color="#333744" text-color="#fff" unique-opened>
  <el-menu background-color="#333744" text-color="#fff" :unique-opened="true"> 
```

菜单的边框线对齐:

```
.el-menu {
  border-right: none;
}
```

#### 4、菜单的折叠与展开

**Menu Attribute**

| 参数                | 说明                                                 | 类型    | 可选值 | 默认值 |
| :------------------ | :--------------------------------------------------- | :------ | :----- | :----- |
| collapse-transition | 是否开启折叠动画                                     | boolean |        | true   |
| collapse            | 是否水平折叠收起菜单（仅在 mode 为 vertical 时可用） | boolean | —      | false  |

（1）盒子：菜单的折叠与展开 ；

（2）解决侧边栏宽度固定的方法：

```
   <el-aside :width="isCollapse ? '64px' : '200px'">
```

7、实现右侧内容区路由重定向

（1）在右侧内容区为组件占位（2）实现Welcome组件（3）在router中注册并重定向（注意路由关系）

![image-20220402154525584](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220402154525584.png)

#### 5、左侧菜单改造为路由链接

**Menu-Item Attribute**

| 参数  | 说明     | 类型   | 可选值 | 默认值 |
| :---- | :------- | :----- | :----- | :----- |
| index | 唯一标志 | string | —      | —      |

**Menu Attribute**

| 参数   | 说明                                                         | 类型    | 可选值 | 默认值 |
| :----- | :----------------------------------------------------------- | :------ | :----- | :----- |
| router | 是否使用 vue-router 的模式，启用该模式会在激活导航时以 index 作为 path 进行路由跳转 | boolean | —      | false  |

（1）为menu开启vue-router 的模式（2）以 index 作为 path 进行路由跳转

```
  <el-menu-item
              :index="'/' + second.path"
              v-for="second in item.children"
              :key="second.id"
            >
```

#### 6、当前激活菜单高亮

**Menu Attribute**：

| 参数           | 说明                 | 类型   | 可选值 | 默认值 |
| :------------- | :------------------- | :----- | :----- | :----- |
| default-active | 当前激活菜单的 index | string | —      | —      |

（1）点击链接时，把对应的地址保存在sessionStorage中

二级菜单链接：

```
 // 保存链接的激活状态
    saveSubState(activepath) {
    //如果不经过session 刷新就全收缩了
      window.sessionStorage.setItem("activepath", activepath);
      this.activepath = activepath;
    },
```

（2）当首页刷新（创建）时，再把sessionStorage中的值取出来，赋值给default-active

```
created() {
    //this.getMenuList();
    this.activepath = window.sessionStorage.getItem("activepath");
  },
```

### 3、绘制用户列表的基本ui结构

**路由跳转展示用户组件**

**渲染基本页面结构**

**Breadcrumb 面包屑**：显示当前页面的路径，快速返回之前的任意页面。

**Table Attributes**:用于展示多条结构类似的数据，可对数据进行排序、筛选、对比或其他自定义操作。

| 参数   | 说明               | 类型    | 可选值 | 默认值 |
| :----- | :----------------- | :------ | :----- | :----- |
| stripe | 是否为斑马纹 table | boolean | —      | false  |
| border | 是否带有纵向边框   | boolean | —      | false  |

![image-20220402182821353](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220402182821353.png)

#### 1、获取用户列表数据

```
 created() {
    this.getUserList();
  },
  methods: {
    async getUserList() {
      const { data: res } = await this.$http.get("users", {
        params: this.queryInfo,
      });
      if (res.meta.status !== 200) {
        return this.$message.error(res.meta.msg);
      }
      this.userlist = res.data.users;
      this.total = res.data.total;
      console.log(res);
    },
```

#### 2、渲染用户列表数据

**Table Attributes**:用于展示多条结构类似的数据，可对数据进行排序、筛选、对比或其他自定义操作。

| 参数 | 说明       | 类型  | 可选值 | 默认值 |
| :--- | :--------- | :---- | :----- | :----- |
| data | 显示的数据 | array | —      | —      |

通过table渲染用户的数据，data传入数据源

**Table-column Attributes**

| 参数  | 说明                                                         | 类型   | 可选值                 | 默认值 |
| :---- | :----------------------------------------------------------- | :----- | :--------------------- | :----- |
| prop  | 对应列内容的字段名，也可以使用 property 属性                 | string | —                      | —      |
| label | 显示的标题                                                   | string | —                      | —      |
| type  | 对应列的类型。如果设置了 `selection` 则显示多选框；如果设置了 `index` 则显示该行的索引（从 1 开始计算）；如果设置了 `expand` 则显示为一个可展开的按钮 | string | selection/index/expand | —      |

prop"接收指定的数据

索引列

```
 <el-table-column type="index"></el-table-column>
```

![image-20220404150318490](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220404150318490.png)

#### 3、插槽形式自定义列的渲染

**Switch 开关**:表示两种相互对立的状态间的切换，多用于触发「开/关」。布尔值

```
 <!-- 当prop的值为布尔值时，页面不会显示 -->
        <el-table-column prop="mg_state" label="状态" width="180">
          <!-- 作用域插槽/具名插槽：会覆盖上面prop的内容 ，通过scope.row获取这一行的数据-->
          <template v-slot="scope">
            <el-switch v-model="scope.row.mg_state"> </el-switch>
          </template>
        </el-table-column>
```

![image-20220402221748294](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220402221748294.png)

**ToolTipAttributes文字提示**:常用于展示鼠标 hover 时的提示信息

| 参数      | 说明                                           | 类型    | 可选值                                                       | 默认值 |
| :-------- | :--------------------------------------------- | :------ | :----------------------------------------------------------- | :----- |
| effect    | 默认提供的主题                                 | String  | dark/light                                                   | dark   |
| content   | 显示的内容，也可以通过 `slot#content` 传入 DOM | String  | —                                                            | —      |
| placement | Tooltip 的出现位置                             | String  | top/top-start/top-end/bottom/bottom-start/bottom-end/left/left-start/left-end/right/right-start/right-end | bottom |
| enterable | 鼠标是否可进入到 tooltip 中                    | Boolean | —                                                            | true   |

```
 <el-table-column label="操作" width="180px">
          <template v-slot="scope">
            <!-- 修改按钮 -->
            <el-button
              type="primary"
              icon="el-icon-edit"
              size="mini"
            ></el-button>
            <!-- 删除按钮 -->
            <el-button
              type="danger"
              icon="el-icon-delete"
              size="mini"
            ></el-button>
            <!-- 分配角色按钮 -->
            <el-tooltip
              effect="dark"
              content="修改角色"
              placement="top"
              :enterable="false"
            >
              <el-button
                type="warning"
                icon="el-icon-setting"
                size="mini"
              ></el-button>
            </el-tooltip>
          </template>
        </el-table-column>
```

![image-20220402221828443](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220402221828443.png)

#### 4、实现数据分页效果

**Pagination 分页**：当数据量过多时，使用分页分解数据

**Attributes**

| 参数         | 说明                                | 类型     | 可选值                                                       | 默认值                                 |
| :----------- | :---------------------------------- | :------- | :----------------------------------------------------------- | :------------------------------------- |
| background   | 是否为分页按钮添加背景色            | boolean  | —                                                            | false                                  |
| page-size    | 每页显示条目个数，支持 .sync 修饰符 | number   | —                                                            | 10                                     |
| total        | 总条目数                            | number   | —                                                            | —                                      |
| current-page | 当前页数，支持 .sync 修饰符         | number   | —                                                            | 1                                      |
| layout       | 组件布局，子组件名用逗号分隔        | String   | `sizes`, `prev`, `pager`, `next`, `jumper`, `->`, `total`, `slot` | 'prev, pager, next, jumper, ->, total' |
| page-sizes   | 每页显示个数选择器的选项设置        | number[] | —                                                            | [10, 20, 30, 40, 50, 100]              |

**Events**

| 事件名称       | 说明                     | 回调参数 |
| :------------- | :----------------------- | :------- |
| size-change    | pageSize 改变时会触发    | 每页条数 |
| current-change | currentPage 改变时会触发 | 当前页   |

```
  <el-pagination
        @size-change="handleSizeChange"
        @current-change="handleCurrentChange"
        :current-page="queryInfo.pagenum"
        :page-sizes="[1, 2, 5, 10]"
        :page-size="queryInfo.pagesize"
        layout="total, sizes, prev, pager, next, jumper"
        :total="total"
      >
      </el-pagination>
```

```
   async getUserList() {
      const { data: res } = await this.$http.get("users", {
        params: this.queryInfo,
      });
      if (res.meta.status !== 200) {
        return this.$message.error(res.meta.msg);
      }
      this.userlist = res.data.users;
      this.total = res.data.total;
      console.log(res);
    },
 // 监听pagesize改变的事件
    handleSizeChange(newsize) {
    //同时更改
      this.queryInfo.pagesize = newsize;
      this.getUserList();
      console.log(newsize);
    },
    // 监听页码改变的事件
    handleCurrentChange(newpage) {
    //同时更改
      this.queryInfo.pagenum = newpage;
      this.getUserList();
    },
```

#### 5、实现用户状态的修改

（1）监听switch状态，拿到最新状态（2）调用对应的api接口，把状态保存在数据库

**Switch 开关**：表示两种相互对立的状态间的切换，多用于触发「开/关」。

**Events**

| 事件名称 | 说明                            | 回调参数   |
| :------- | :------------------------------ | :--------- |
| change   | switch 状态发生变化时的回调函数 | 新状态的值 |

```
 <template v-slot="scope">
            <el-switch
              v-model="scope.row.mg_state"
              @change="userStateChange(scope.row)"
            >
            </el-switch>
```

```
  // 监听switch按钮开关的状态改变
    async userStateChange(userinfo) {
      const { data: res } = await this.$http.put(
        `users/${userinfo.id}/state/${userinfo.mg_state}`
      );
      if (res.meta.status !== 200) {
      //修改失败，用户状态不变
        userinfo.mg_state != userinfo.mg_state;
        return this.$message.error("状态修改失败");
      }
      this.$message.success("状态修改成功");
    },
```

#### 6、实现搜索功能

**Input 输入框**：通过鼠标或键盘输入字符

**Input Attributes**

| 参数      | 说明       | 类型    | 可选值 | 默认值 |
| :-------- | :--------- | :------ | :----- | :----- |
| clearable | 是否可清空 | boolean | —      | false  |

**Input Events**

| 事件名称 | 说明                                          | 回调参数 |
| :------- | :-------------------------------------------- | :------- |
| clear    | 在点击由 `clearable` 属性生成的清空按钮时触发 | —        |

点击搜索按钮，搜索相应用户；点击清除文本，将显示初始界面的数据

```
 <div>
            <el-input
              placeholder="请输入内容"
              v-model="queryInfo.query"
              clearable
              @clear="getUserList"
            >
              <el-button
                slot="append"
                icon="el-icon-search"
                @click="getUserList"
              ></el-button>
            </el-input></div
        >
```

```
data() {
    return {
      queryInfo: {
        query: "",
        // 当前的页数
        pagenum: 1,
        // 当前的页面下显示多少条数据
        pagesize: 2,
      },
    };
  }
async getUserList() {
      const { data: res } = await this.$http.get("users", {
        params: this.queryInfo,
      });
      if (res.meta.status !== 200) {
        return this.$message.error(res.meta.msg);
      }
      this.userlist = res.data.users;
      this.total = res.data.total;
      console.log(res);
    }
```

![image-20220403133407543](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220403133407543.png)

#### 7、实现添加用户按钮

（1）添加用户对话框

**Dialog 对话框**：在保留当前页面状态的情况下，告知用户并承载相关操作。

**Attributes**

| 参数    | 说明                               | 类型    | 可选值 | 默认值 |
| :------ | :--------------------------------- | :------ | :----- | :----- |
| visible | 是否显示 Dialog，支持 .sync 修饰符 | boolean | —      | false  |

（2）对话框中渲染添加用户表单

![image-20220403142001085](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220403142001085.png)

（3）为邮箱、手机号添加自定义校验规则

```
data() {
    //   验证邮箱规则
    var checkEmail = (rule, value, callback) => {
      const regEmail = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/;
      if (regEmail.test(value)) {
        return callback();
      }
      callback(new Error("请输入合法的邮箱"));
    };
    //   验证手机规则
    var checkMobile = (rule, value, callback) => {
      const regEmail = /^1[3456789]\d{9}$/;
      if (regEmail.test(value)) {
        return callback();
      }
      callback(new Error("请输入合法的手机号"));
    };
    return{}}
```

```
通过validator指向自定义校验规则
{ validator: checkMobile, trigger: "blur" }
```

（4）实现添加用户表单的重置功能

当对话框关闭时，表单内容重置

**Dialog 对话框**：在保留当前页面状态的情况下，告知用户并承载相关操作。

**Events**

| 事件名称 | 说明                        | 回调参数 |
| :------- | :-------------------------- | :------- |
| closed   | Dialog 关闭动画结束时的回调 | —        |

**Form Methods**

| 方法名      | 说明                                                       | 参数 |
| :---------- | :--------------------------------------------------------- | :--- |
| resetFields | 对整个表单进行重置，将所有字段值重置为初始值并移除校验结果 | —    |

（5）点击按钮，进行表单验证成功后，添加新用户到数据库

```
 //将用户添加到数据库
    addUser() {
      //验证表单合法性
      this.$refs.addRuleForm.validate(async (value) => {
        if (!value) return this.$message.error("添加用户失败");
        const { data: res } = await this.$http.post("/users", this.addForm);
        //验证请求是否成功
        if (res.meta.status !== 201) {
          return this.$message.success(res.meta.msg);
        }
        this.$message.success(res.meta.msg);
        // 隐藏添加用户对话框
        this.addDialogVisible = false;
        // 重新获取用户列表数据
        this.getUserList();
      });
    },
```

#### 8、添加修改用户信息的功能

（1）点击修改按钮，弹出对话框显示“当前id”的用户数据（根据id渲染表单）

```
// 对话框展示当前用户信息（根据当前id发起请求）
    async editUser(id) {
        // 弹出编辑当前用户信息对话框
      this.editDialogVisible = true;
      console.log(id);
      const { data: res } = await this.$http.get("users/" + id);
      if (res.meta.status !== 200) {
        return this.$message.error(res.meta.msg);
      }
      this.currentUserForm = res.data;
    //   console.log(this.currentUserForm);
    },
```

（2）当对话框关闭时，移除校验结果

**Form Methods**

| 方法名      | 说明                                                       | 参数 |
| :---------- | :--------------------------------------------------------- | :--- |
| resetFields | 对整个表单进行重置，将所有字段值重置为初始值并移除校验结果 | —    |

```
// 监听展示、修改用户信息对话框关闭事件
    editDialogClose() {
      this.$refs.editRuleForm.resetFields();
    },
```

（3）点击按钮，进行表单验证成功后，修改用户信息到数据库

```
// 修改用户信息并提交到数据库
    editUserInfo() {
      //验证表单合法性
      this.$refs.editRuleForm.validate(async (value) => {
        if (!value) return this.$message.error("修改用户失败");
        const { data: res } = await this.$http.put(
          "users/" + this.currentUserForm.id,
          {
            email: this.currentUserForm.email,
            mobile: this.currentUserForm.mobile,
          }
        );
        //验证请求是否成功
        if (res.meta.status !== 200) {
          return this.$message.error(res.meta.msg);
        }
        // 提示更新成功
        this.$message.success(res.meta.msg);
        // 刷新用户列表
        this.getUserList();
        // 关闭对话框
        this.editDialogVisible = false;
      });
    },
```

#### 9、实现删除用户操作

点击删除按钮，弹出消息提示框

```
// 根据id删除用户
    async removeUserById(id) {
      // 弹窗询问用户是否删除数据
      //在vue原型上添加this.$confirm，值为MessageBox.confirm
      const data = await this.$confirm(
        "此操作将永久删除该拥护, 是否继续?",
        "提示",
        {
          confirmButtonText: "确定",
          cancelButtonText: "取消",
          type: "warning",
        }
        //如果不加catch捕获异常，点击取消按钮时，控制台将报错
        //只有捕获异常，才能得到cancel字符串
        //捕获异常，返回err，data接收异常信息（err）
      ).catch((err) => err);
      //点击确定，返回字符串，confirm
      // 点击取消，返回字符串，cancel
      console.log(data);
      if (data !== "confirm") {
        return this.$message.info("取消删除该用户");
      }
      const { data: res } = await this.$http.delete("users/" + id);
      if (res.meta.status !== 200) return this.$message.error("删除失败");
      this.$message.success(res.meta.msg);
      this.getUserList();
    },
```

![image-20220403183217281](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220403183217281.png)

#### 10、实现修改、分配角色功能

点击按钮---》弹出对话框---》在对话框弹出之前，当前被操作的用户的数据就应该得到并显示---》以下拉的形式显示所有角色列表

---》选中角色后，点击确定按钮分配角色---》退出对话框重置保存当前这一行的用户数据一级角色id

**Select 选择器**：当选项过多时，使用下拉菜单展示并选择内容。

**Select Attributes**

| 参数            | 说明   | 类型                      | 可选值 | 默认值 |
| :-------------- | :----- | :------------------------ | :----- | :----- |
| value / v-model | 绑定值 | boolean / string / number | —      | —      |

**Option Attributes**

| 参数  | 说明                                      | 类型                 | 可选值 | 默认值 |
| :---- | :---------------------------------------- | :------------------- | :----- | :----- |
| value | 选项的值                                  | string/number/object | —      | —      |
| label | 选项的标签，若不设置则默认与 `value` 相同 | string/number        | —      | —      |

```
  // 点击按钮分配角色
    async savaRoleInfo() {
    //判断是否选择角色
      if (!this.selectRoleId) return this.$message.error("请选择角色");
      const { data: res } = await this.$http.put(
        `users/${this.userinfo.id}/role`,
        { rid: this.selectRoleId }
      );
      if (res.meta.status !== 200) return this.$message.error("分配角色失败");
      this.$message.success(res.meta.msg);
      this.getUserList();
      this.setRoledialogVisible = false;
    },
    // 监听分配角色对话框的关闭事件
    setRoleDialogClose() {
      // 重置
      this.selectRoleId = "";
      this.userinfo = {};
    },
```

![image-20220405132909311](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220405132909311.png)

#### 10、提交到码云

### 4、权限管理开发

#### 1、权限列表

**路由跳转展示权限组件**

**渲染基本页面结构**

**Breadcrumb 面包屑**：显示当前页面的路径，快速返回之前的任意页面。

**Table Attributes**:用于展示多条结构类似的数据，可对数据进行排序、筛选、对比或其他自定义操作。

| 参数   | 说明               | 类型    | 可选值 | 默认值 |
| :----- | :----------------- | :------ | :----- | :----- |
| stripe | 是否为斑马纹 table | boolean | —      | false  |
| border | 是否带有纵向边框   | boolean | —      | false  |

##### 1、获取权限列表数据

```
 created() {
    this.getRightList();
  }
async getRightList() {
      const { data: res } = await this.$http.get("rights/list");
      if (res.meta.status !== 200)
        return this.$message.error("获取权限列表失败");
      this.$message.success(res.meta.msg);
      this.rightList = res.data;
    },
```

##### 2、渲染权限列表数据

**Tag 标签**：用于标记和选择。

**Table Attributes**:用于展示多条结构类似的数据，可对数据进行排序、筛选、对比或其他自定义操作。

| 参数 | 说明       | 类型  | 可选值 | 默认值 |
| :--- | :--------- | :---- | :----- | :----- |
| data | 显示的数据 | array | —      | —      |

通过table渲染用户的数据，data传入数据源

**Table-column Attributes**

| 参数  | 说明                                                         | 类型   | 可选值                 | 默认值 |
| :---- | :----------------------------------------------------------- | :----- | :--------------------- | :----- |
| prop  | 对应列内容的字段名，也可以使用 property 属性                 | string | —                      | —      |
| label | 显示的标题                                                   | string | —                      | —      |
| type  | 对应列的类型。如果设置了 `selection` 则显示多选框；如果设置了 `index` 则显示该行的索引（从 1 开始计算）；如果设置了 `expand` 则显示为一个可展开的按钮 | string | selection/index/expand | —      |

prop"接收指定的数据

```
  <el-table :data="rightList" stripe border>
        <!-- 索引列 -->
        <el-table-column type="index"></el-table-column>
        <el-table-column prop="authName" label="权限名称"> </el-table-column>
        <el-table-column prop="path" label="路径"> </el-table-column>
        <el-table-column prop="level" label="权限等级">
          <template v-slot="scope">
            <el-tag v-if="scope.row.level === '0'">一级</el-tag>
            <el-tag type="success" v-else-if="scope.row.level === '1'"
              >二级</el-tag
            >
            <el-tag type="warning" v-else>三级</el-tag>
          </template>
        </el-table-column>
      </el-table>
```

索引列

```
 <el-table-column type="index"></el-table-column>
```



![image-20220404150157189](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220404150157189.png)

#### 2、角色列表

**路由跳转展示角色组件**

**渲染基本页面结构**

**Breadcrumb 面包屑**：显示当前页面的路径，快速返回之前的任意页面。

 **Layout 布局**：通过基础的 24 分栏，迅速简便地创建布局。**Button 按钮**：常用的操作按钮。

**Table Attributes**:用于展示多条结构类似的数据，可对数据进行排序、筛选、对比或其他自定义操作。

| 参数   | 说明               | 类型    | 可选值 | 默认值 |
| :----- | :----------------- | :------ | :----- | :----- |
| stripe | 是否为斑马纹 table | boolean | —      | false  |
| border | 是否带有纵向边框   | boolean | —      | false  |

##### 1、获取权限列表数据

```
 created() {
    this.getRolesList();
  },
  methods: {
    async getRolesList() {
      const { data: res } = await this.$http.get("roles");
      if (res.meta.status !== 200)
        return this.$message.error("获取角色列表失败");
      this.rolesList = res.data;
    },
```



##### 2、渲染角色列表数据

**Table Attributes**:用于展示多条结构类似的数据，可对数据进行排序、筛选、对比或其他自定义操作。

| 参数 | 说明       | 类型  | 可选值 | 默认值 |
| :--- | :--------- | :---- | :----- | :----- |
| data | 显示的数据 | array | —      | —      |

通过table渲染用户的数据，data传入数据源

**Table-column Attributes**

| 参数  | 说明                                                         | 类型   | 可选值                 | 默认值 |
| :---- | :----------------------------------------------------------- | :----- | :--------------------- | :----- |
| prop  | 对应列内容的字段名，也可以使用 property 属性                 | string | —                      | —      |
| label | 显示的标题                                                   | string | —                      | —      |
| type  | 对应列的类型。如果设置了 `selection` 则显示多选框；如果设置了 `index` 则显示该行的索引（从 1 开始计算）；如果设置了 `expand` 则显示为一个可展开的按钮 | string | selection/index/expand | —      |

prop"接收指定的数据

![image-20220404154455918](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220404154455918.png)

```
  <!-- 展开列 -->
        <el-table-column type="expand"></el-table-column>
        <!-- 索引列 -->
        <el-table-column type="index"></el-table-column>
```

##### 3、实现添加角色按钮

##### 4、渲染角色的一级权限

```
<!-- 展开列 -->
        <el-table-column type="expand">
          <template v-slot="scope">
            <el-row
              :class="['bdbottom', i1 === 0 ? bdtop : '']"
              v-for="(item, i1) in scope.row.children"
              :key="item.id"
            >
              <!-- 渲染一级权限 -->
              <el-col :span="5">
                <el-tag>{{ item.authName }}</el-tag>
                <i class="el-icon-caret-right"></i>
              </el-col>
              <!-- 渲染二级权限 -->
              <el-col :span="19"></el-col>
            </el-row>
          </template>
        </el-table-column>
```

###### 小技巧：

为每一行添加边框线，通过动态数据绑定（只有第一行有上边框，所以需要动态数据绑定，根据索引下标判断是否为第一行）

![image-20220404165656137](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220404165656137.png)

##### 5、渲染角色的二、三级权限

```
 <!-- 渲染二级和三级权限权限 -->
              <el-col :span="19">
                <!-- 渲染二级权限 -->
                <el-row
                  :class="[i2 === 0 ? '' : 'bdtop']"
                  v-for="(item2, i2) in item.children"
                  :key="item2.id"
                >
                  <el-col :span="6">
                    <el-tag type="success">{{ item2.authName }}</el-tag>
                    <i class="el-icon-caret-right"></i>
                  </el-col>
                  <!-- 渲染三级权限 -->
                  <el-col :span="18">
                    <el-tag
                      type="warning"
                      v-for="(item3, i3) in item2.children"
                      :key="item3.id"
                    >
                      {{ item3.authName }}</el-tag
                    >
                  </el-col>
                </el-row>
              </el-col>
```

![image-20220404171948388](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220404171948388.png)

##### 6、删除角色指定权限

 **Tag 标签**：用于标记和选择

**Attributes**

| 参数     | 说明       | 类型    | 可选值 | 默认值 |
| :------- | :--------- | :------ | :----- | :----- |
| closable | 是否可关闭 | boolean | —      | false  |

**Events**

| 事件名称 | 说明                  | 回调参数 |
| :------- | :-------------------- | :------- |
| click    | 点击 Tag 时触发的事件 | —        |
| close    | 关闭 Tag 时触发的事件 | —        |

为tag添加可删除的地方

**MessageBox 弹框**:模拟系统的消息提示框而实现的一套模态对话框组件，用于消息提示、确认消息和提交内容。

点击--->弹出消息框--->确定是否删除该权限--->删除后--->更新界面

```
  <!-- 渲染二级权限 -->
                <el-row
                  :class="['vcenter', i2 === 0 ? '' : 'bdtop']"
                  v-for="(item2, i2) in item.children"
                  :key="item2.id"
                >
                  <el-col :span="6">
                    <el-tag
                      type="success"
                      closable
                      @close="removeRoleById(scope.row, item2.id)"
                      >{{ item2.authName }}</el-tag
                    >
                    <i class="el-icon-caret-right"></i>
                  </el-col>
                  <!-- 渲染三级权限 -->
                  <el-col :span="18">
                    <el-tag
                      type="warning"
                      v-for="(item3, i3) in item2.children"
                      :key="item3.id"
                      closable
                      @close="removeRoleById(scope.row, item3.id)"
                    >
                      {{ item3.authName }}</el-tag
                    >
                  </el-col>
                </el-row>
```



```
 //删除角色权限
    async removeRoleById(role, right) {
      const a = await this.$confirm(
        "此操作将永久删除该角色, 是否继续?",
        "提示",
        {
          confirmButtonText: "确定",
          cancelButtonText: "取消",
          type: "warning",
        }
      ).catch((err) => err);
      if (a !== "confirm") return this.$message.info("取消删除该角色指定权限");
      //  返回的data, 是当前角色下最新的权限数据
      const { data: res } = await this.$http.delete(
        `roles/${role.id}/rights/${right}`
      );
      if (res.meta.status !== 200) return this.$message.error("删除失败");
      this.$message.success(res.meta.msg);
      //   this.getRolesList();会关闭扩展区域：会重新获取整个列表，列表会重新渲染
      //  因为返回的data, 是当前角色下最新的权限数据 为防止删除权限后，扩展区域合起来
      role.children = res.data;
    },
```



##### 7、实现分配权限功能

###### 1、点击分配权限按钮--->弹出对话框--->以树状结构展示权限数据

 **Tree 树形控件**：用清晰的层级结构展示信息，可展开或折叠。

**Attributes**

| 参数  | 说明                 | 类型   | 可选值 | 默认值 |
| :---- | :------------------- | :----- | :----- | :----- |
| props | 配置选项，具体看下表 | object | —      | —      |
| data  | 展示数据             | array  | —      | —      |

：props为整个树指定绑定的数据源字段

```
<!-- 分配权限对话框 -->
    <el-dialog title="分配权限" :visible.sync="setRightDialog" width="50%">
      <!-- 树形控件 -->
      <el-tree
        :data="rightsList"
        :props="treeProps"
        show-checkbox
        node-key="id"
        default-expand-all="true"
      >
      </el-tree>
      <span slot="footer" class="dialog-footer">
        <el-button @click="setRightDialog = false">取 消</el-button>
        <el-button type="primary" @click="setRightDialog = false"
          >确 定</el-button
        >
      </span>
    </el-dialog>
```

```
 //   树形控件的属性绑定对象
      treeProps: {
        //   页面显示的文本是数据源的哪一个字段
        label: "authName",
        // 通过那个属性实现父子嵌套
        children: " children",
      },
```

```
// 展示分配权限的对话框
    async showSetRightDialog() {
      this.setRightDialog = true;
      // 获取所有权限的数据，tree 树状显示权限,
      const { data: res } = await this.$http.get("rights/tree");
      if (res.meta.status !== 200)
        return this.$message.error("获取权限数据失败");
      // 把获取到的权限数据保存到rightsList中
      this.rightsList = res.data;
      this.$message.success(res.meta.msg);
    },
```

###### 2、勾选默认三级节点的权限

**Tree Attributes**

| 参数                 | 说明                                                 | 类型    | 可选值 | 默认值 |
| :------------------- | :--------------------------------------------------- | :------ | :----- | :----- |
| node-key             | 每个树节点用来作为唯一标识的属性，整棵树应该是唯一的 | String  | —      | —      |
| default-expand-all   | 是否默认展开所有节点                                 | boolean | —      | false  |
| default-checked-keys | 默认勾选的节点的 key 的数组                          | array   | —      | —      |

```
  // 通过递归的方式，获取角色下所有的三级权限id，并保存在defKeys中
    getLeafKeys(node, arr) {
      // 如果当前节点下没children属性，则是三级节点，直接取出id
      if (!node.children) return arr.push(node.id);
       // 如果当前节点下有children属性，则递归，一直到没有children为止
       //判断node.children下的节点是不是三级节点
      node.children.forEach((item) => {
        this.getLeafKeys(item, arr);
      });
    }
```

```
 // 展示分配权限的对话框
    async showSetRightDialog(node) {
      // 获取所有权限的数据,tree 树状显示权限,
      const { data: res } = await this.$http.get("rights/tree");
      if (res.meta.status !== 200)
        return this.$message.error("获取权限数据失败");
      // 把获取到的权限数据保存到rightsList中
      this.rightsList = res.data;
      console.log(this.rightsList);
      this.$message.success(res.meta.msg);
      this.getLeafKeys(node, this.defKeys);
      this.setRightDialog = true;
    },
```

###### 3、对话框关闭，数据清空

直接将保存id的数组清空

这一步防止数组一直叠加，导致后面的角色，在分配角色时，树形结构勾选了其没有的权限

###### 4、为角色分配权限

![image-20220404234625994](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220404234625994.png)

**方法**：Tree` 内部使用了 Node 类型的对象来包装用户传入的数据，用来保存目前节点的状态

| 方法名              | 说明                                                         | 参数                                                         |
| :------------------ | :----------------------------------------------------------- | :----------------------------------------------------------- |
| getCheckedKeys      | 若节点可被选择（即 `show-checkbox` 为 `true`），则返回目前被选中的节点的 key 所组成的数组 | (leafOnly) 接收一个 boolean 类型的参数，若为 `true` 则仅返回被选中的叶子节点的 keys，默认值为 `false` |
| getHalfCheckedNodes | 若节点可被选择（即 `show-checkbox` 为 `true`），则返回目前半选中的节点所组成的数组 | -                                                            |

```
// 点击确定按钮，为角色分配权限
    async allotRight() {
      // 得到半勾选，或者勾选的权限
      const keys = [
        ...this.$refs.treeRef.getCheckedKeys(),
        ...this.$refs.treeRef.getHalfCheckedKeys(),
      ];
      // 格式化成传入参数需要的格式
      const keysId = keys.join(",");
      // console.log(keys);
      const { data: res } = await this.$http.post(
        // 在点击分配权限按钮时，同时获得roleid以供使用
        `roles/${this.roleId}/rights`,
        { rids: keysId }
      );
      if (res.meta.status !== 200) return this.$message.error("更新失败");
      this.$message.success(res.meta.msg);
      this.getRolesList();
      this.setRightDialog = false;
    },
```

### 5、商品管理开发

#### 1、分类管理

![image-20220405134936702](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220405134936702.png)

#### （1）创建分类管理git分支

#### （2）点击商品分类进行路由跳转

创建商品分类组件---》在路由中注册---》构建基本的页面结构

#### （3）表格区域

##### 1、获取商品分类数据

##### 2、下载vue-table-with依赖

导入依赖---》全局注册组件

```
import TreeTable from 'vue-table-with-tree-grid'
Vue.component('tree-table', TreeTable)
```

##### 3、绘制表格/渲染”分类名称“

**vue-table-with-tree-grid**[https://github.com/MisterTaki/vue-table-with-tree-grid]()

**Table Attributes**

| 属性           | 说明                                                         | 类型    | 参数 | 默认值 |
| -------------- | ------------------------------------------------------------ | ------- | ---- | ------ |
| data           | 表格各行的数据                                               | Array   | -    | []     |
| columns        | 表格各列的配置（具体见下文：Columns Configs）                | Array   | -    | []     |
| show-index     | 是否显示数据索引                                             | Boolean | -    | false  |
| index-text     | 数据索引名称                                                 | String  | -    | '序号  |
| stripe         | 是否显示间隔斑马纹                                           | Boolean | -    | false  |
| border         | 是否显示纵向边框                                             | Boolean | -    | false  |
| show-row-hover | 鼠标悬停时，是否高亮当前行                                   | Boolean | -    | true   |
| selection-type | 是否为多选类型表格                                           | Boolean | -    | false  |
| expand-type    | 是否为展开行类型表格（为 True 时，需要添加名称为 '$expand' 的[作用域插槽](https://cn.vuejs.org/v2/guide/components.html#作用域插槽), 它可以获取到 row, rowIndex) | Boolean | -    | false  |

**Columns Configs**

| 属性        | 说明                                                         | 类型             | 默认值 |
| ----------- | ------------------------------------------------------------ | ---------------- | ------ |
| label       | 列标题名称                                                   | String           | ''     |
| prop        | 对应列内容的属性名                                           | String           | ''     |
| align       | 对应列内容的对齐方式，可选值有 'center', 'right'             | String           | 'left' |
| headerAlign | 对应列标题的对齐方式，可选值有 'center', 'right'             | String           | 'left' |
| width       | 列宽度                                                       | [String, Number] | 'auto' |
| minWidth    | 列最小宽度                                                   | [String, Number] | '80px' |
| type        | 列类型，可选值有 'template'(自定义列模板)                    | String           | ''     |
| template    | 列类型为 'template'(自定义列模板) 时，对应的[作用域插槽](https://cn.vuejs.org/v2/guide/components.html#作用域插槽)（它可以获取到 row, rowIndex, column, columnIndex）名称 | String           | ''     |

注：鼠标悬停时，是否高亮当前行为true，页面将延迟

```
 <!-- 表格区 -->
      <tree-table
        ref="table"
        :data="CuteList"
        :columns="columns"
        show-index
        index-text="#"
        stripe
        border
        :show-row-hover="false"
        :selection-type="false"
        :expand-type="false"
      >
      </tree-table>
```

```
//   为table指定列的定义
      columns: [
        {
          label: "分类名称",
          prop: "cat_name",
        },
```

![image-20220405150006724](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220405150006724.png)

##### 4、使用模板列渲染”是否有效“

```
 columns: [
        {
          label: "是否有效",
          prop: "cat_deleted",
          // 表示将当前列定义为模板列
          type: "template",
          // 表示当前这一列使用的模板名称
          template: "isdeleted",
        },]
```

```
 <tree-table>
   <template slot="isdeleted" slot-scope="scope">
          <i
            class="el-icon-success"
            style="color: lightgreen"
            v-if="scope.row.cat_deleted === false"
          ></i>
          <i class="el-icon-error" style="color: red" v-else></i>
        </template>
      </tree-table>
```

![image-20220413140723624](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220413140723624.png)

##### 5、渲染”排序“，”操作“

##### 6、实现分页

#### （4）添加分类操作

数据来源---》配置对象---》保存选中的值

##### 1、点击按钮弹出对话框

对话框弹出之前应该  获取父级分类的数据列表

##### 2、绘制表单第一行

数据双向绑定、验证规则

##### 3、绘制表单第二行父级分类

获取父级分类的数据列表---》

###### 1、通过cascader渲染父级分类列表

**[¶](https://element.eleme.cn/#/zh-CN/component/cascader#cascader-ji-lian-xuan-ze-qi)Cascader 级联选择器**：当一个数据集合有清晰的层级结构时，可通过级联选择器逐级查看并选择。

**Cascader Attributes**

| 参数            | 说明                                      | 类型    | 可选值 | 默认值 |
| :-------------- | :---------------------------------------- | :------ | :----- | :----- |
| value / v-model | 选中项绑定值                              | -       | —      | —      |
| options         | 可选项数据源，键名可通过 `Props` 属性配置 | array   | —      | —      |
| props           | 配置选项，具体见下表                      | object  | —      | —      |
| clearable       | 是否支持清空选项                          | boolean | —      | false  |

**Props**

| 参数          | 说明                                   | 类型    | 可选值        | 默认值     |
| :------------ | :------------------------------------- | :------ | :------------ | :--------- |
| expandTrigger | 次级菜单的展开方式                     | string  | click / hover | 'click'    |
| checkStrictly | 是否严格的遵守父子节点不互相关联       | boolean | -             | false      |
| value         | 指定选项的值为选项对象的某个属性值     | string  | —             | 'value'    |
| label         | 指定选项标签为选项对象的某个属性值     | string  | —             | 'label'    |
| children      | 指定选项的子选项为选项对象的某个属性值 | string  | —             | 'children' |

注意:checkStrictly   可以随意选择对象，不设置就只能选择最后一级的对象

```
<el-form-item label="父级分类">
            <!-- 级联选择器
            options指定数据源
            props指定配置对象
             v-mode将选中的值双向绑定到中，它是一个数组
             @change事件   选择项发生变化触发这个函数
             -->
            <el-cascader
              :options="parentCateList"
              :props="{
                expandTrigger: 'hover',
                ...cascaderProps,//连接对象
              }"
              @change="parentCateChange"
              v-model="seletedKeys"
              :clearable="true"
            ></el-cascader>
          </el-form-item>
```

```
  // 商品分类父级数据列表
      parentCateList: [],
      // 级联选择器配置对象
      cascaderProps: {
        value: "cat_id", // 指定选中的值
        label: "cat_name", // 指定看到的值
        children: "children", // 指定父子嵌套的值
        checkStrictly: "true",
      },
      // 选中的父级分类的id数组
      seletedKeys: [],
```

![image-20220414111233899](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220414111233899.png)

###### 解决级联选择器铺满全屏的问题

###### 注意：

新版本的element-ui级联选择器会铺满整个屏幕，需要在全局样式中处理

```
/* 解决级联选择器铺满全屏的问题 */
/* 列表栈占满全屏 */
.el-cascader-panel {
    max-height: 200px;
}

/* .el-cascader-menu {
    max-height: 200px;
} */
```

###### 2、 监听选择项的变化并处理

将选中的值赋值给请求参数中

**Cascader Events**

| 事件名称 | 说明                 | 回调参数     |
| :------- | :------------------- | :----------- |
| change   | 当选中节点变化时触发 | 选中节点的值 |

```
 // 选择项发生变化触发这个函数
    parentCateChange() {
      if (this.seletedKeys.length > 0) {
        this.AddCateForm.cat_pid =
          this.seletedKeys[this.seletedKeys.length - 1];
        this.AddCateForm.cat_level = this.seletedKeys.length;
      } else {
        this.AddCateForm.cat_pid = 0;
        this.AddCateForm.cat_level = 0;
      }
    },
```

###### 3、对话框关闭，重置表单数据

**Form** **Methods**

| 方法名      | 说明                                                       | 参数 |
| :---------- | :--------------------------------------------------------- | :--- |
| resetFields | 对整个表单进行重置，将所有字段值重置为初始值并移除校验结果 | —    |

```
 // 对话框关闭,重置表单数据
    addCateDialogClose() {
      this.$refs.AddCateFormRef.resetFields();
      this.seletedKeys = [];
      this.AddCateForm.cat_pid = 0;
      this.AddCateForm.cat_level = 0;
    },
```

注意：重置表单只能清空用户输入的数据，无法清空保存输入数据的对象，所以需要单独处理

###### 4、点击确定按钮添加分类

对整个表单进行验证---》发生请求---》判断请求是否成功---》如果成功就刷新界面以及关闭对话框

#### 2、分类参数

#### （1）创建分类参数git分支

创建本地仓库---》码云新创同样的仓库   git checkout -b --->git push -u origin

#### （2）点击分类参数进行路由跳转

#### （3）绘制基本界面、级联选择器

![image-20220414160336580](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220414160336580.png)

这里商品分类的数据列表通过级联选择器进行渲染，具体操作与上面一样

#### （4）绘制tab页签切换

##### ![image-20220414164226255](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220414164226255.png)

##### 1、没有选择分类，tab页签禁用

**[ ¶](https://element.eleme.cn/#/zh-CN/component/tabs#tabs-biao-qian-ye)Tabs 标签页**：分隔内容上有关联但属于不同类别的数据集合。

**Tabs Attributes**

| 参数            | 说明                      | 类型   | 可选值 | 默认值              |
| :-------------- | :------------------------ | :----- | :----- | :------------------ |
| value / v-model | 绑定值，选中选项卡的 name | string | —      | 第一个选项卡的 name |

注意：利用绑定的值，区分不同的tab页签，或作为发送请求时的参数

**Tabs Events**

| 事件名称  | 说明             | 回调参数              |
| :-------- | :--------------- | :-------------------- |
| tab-click | tab 被选中时触发 | 被选中的标签 tab 实例 |

**Tab-pane Attributes**

| 参数     | 说明     | 类型    | 可选值 | 默认值 |
| :------- | :------- | :------ | :----- | :----- |
| disabled | 是否禁用 | boolean | —      | false  |

```
 <!-- tab页签区域 -->
      <el-tabs v-model="activeName" @tab-click="handleTabClick">
        <!-- 添加动态参数的面板 -->
        <el-tab-pane label="动态参数" name="first" :disabled="tabsDiabled">
          <!-- 添加参数的按钮 -->
          <el-button type="primary" size="mini">添加参数</el-button>
        </el-tab-pane>
        <!-- 添加静态属性的面板 -->
        <el-tab-pane label="静态属性" name="second" :disabled="tabsDiabled">
          <!-- 添加属性的按钮 -->
          <el-button type="primary" size="mini">添加属性</el-button>
        </el-tab-pane>
      </el-tabs>
```

页签是否禁用计算属性tabsDiabled

```
 computed: {
    //   决定tab页签是否可用
    tabsDiabled() {
         // 如果级联选择器没有选择，那么页签禁用
      if (this.seletedKeys.length !== 3) {
        return true;
      }
      return false;
    },
  },
```

##### 2、选择分类，渲染tab页签内的表格

###### （1）获取参数列表

```
  //   根据当前选中的id以及面板获取相应的参数列表
      const { data: res } = await this.$http.get(
        `categories/${this.cateId}/attributes`,
        {
          params: { sel: this.activeName },
        }
      );
      if (res.meta.status !== 200)
        return this.$message.error("获取参数列表失败");
      console.log(res.data);
      // 区别参数列表，分别保存
      if (this.activeName === "many") this.manyTableData = res.data;
      this.onlyTableData = res.data;
```

###### 注意：2！！！

获取参数列表的发生有两种情况：选择分类；切换tab页签；

区分获取的是静态属性还是动态参数，请求的数据应该分别保存，避免重复请求

###### （2）通过table渲染参数列表

###### （3）添加参数按钮

点击按钮弹出对话框

​        对话框相似，一为而用：由于两个tab页签内的按钮弹出的对话框相似，所以做一个对话框，对话框的标题以及表单的标题由tab页签的值决定（可以用计算属性）

对话框关闭重置表单

点击确定按钮添加参数---验证表单---发送请求---判断请求是否成功---如果成功刷新tab页签内的表格---关闭对话框

###### （4）修改参数按钮

点击修改按钮  

​        根据id获取当前参数的数据

​        弹出对话框显示当前参数的数据---对话框相似，一为而用

修改参数---点击确定---验证表单---发送请求---验证请求是否成功---如果请求成功，刷新参数表格并关闭对话框

###### （5）删除参数按钮

点击按钮弹出提示框---根据id删除参数

```
  // 点击删除按钮，根据id删除参数
    async deletedParams(id) {
      const result = await this.$confirm(
        "此操作将永久删除该参数, 是否继续?",
        "提示",
        {
          confirmButtonText: "确定",
          cancelButtonText: "取消",
          type: "warning",
        }
      ).catch((err) => err);
      if (result !== "confirm") {
        return this.$message.error("删除参数失败");
      }
      const { data: res } = await this.$http.delete(
        `categories/${this.cateId}/attributes/${id}`
      );
      if (res.meta.status !== 200) return this.$message.error("删除参数失败");
      this.$message.success(res.meta.msg);
      // 删除属性成功后，立马刷新tab页签内的表格数据
      this.handleChange();
    },
  },
```

##### 3、扩展列

###### （1）将获取的参数列表内的attr_vals字符串分割为数组

```
  <!-- 扩展列 -->
            <el-table-column type="expand">
              <template v-slot="scope">
                <div>
                  <!-- 循环渲染tag标签 -->
                  <el-tag
                    v-for="(item, i) in scope.row.attr_vals"
                    :key="i"
                    closable
                  >
                    {{ item }}
                  </el-tag>
                  <!-- 按钮与输入框的切换 -->
                  <el-input
                    class="input-new-tag"
                    v-if="scope.row.inputVisible"
                    v-model="scope.row.inputValue"
                    ref="saveTagInput"
                    size="small"
                    @keyup.enter.native="handleInputConfirm(scope.row)"
                    @blur="handleInputConfirm(scope.row)"
                  >
                  </el-input>
                  <el-button
                    v-else
                    class="button-new-tag"
                    size="small"
                    @click="showInput(scope.row)"
                    >+ New Tag</el-button
                  >
                </div>
              </template>
            </el-table-column>
```



```
 //   监听级联选择框的变化
    async handleChange() {
      //   根据当前选中的id以及面板获取相应的参数列表
      const { data: res } = await this.$http.get(
        `categories/${this.cateId}/attributes`,
        {
          params: { sel: this.activeName },
        }
      );
      if (res.meta.status !== 200)
        return this.$message.error("获取参数列表失败");
      console.log(res.data);
      res.data.forEach((item) => {
        // 解决添加参数，扩展列存在tag的问题
        item.attr_vals = item.attr_vals ? item.attr_vals.split(" ") : [];
        //解决输入框同步的问题
        // 控制文本框的显示与隐藏
        item.inputVisible = false;
        // 文本框中输入的值
        item.inputValue = "";
      });
      // 区别参数列表，分别保存
      if (this.activeName === "many") this.manyTableData = res.data;
      this.onlyTableData = res.data;
    },
```

###### （2）利用tag结合v-for指令渲染

| closable | 是否可关闭 |
| -------- | ---------- |

###### 注意： 2！！！

解决添加参数时，扩展列存在tag的问题；

解决输入框同步的问题：如果在input绑定的数据对象是同一个，这意味打开一个输入框也会打开其他的输入框。解决办法：为每一行的数据添加一个属性

###### （3）按钮切换到输入框自动获取焦点

```
 // 点击切换为input输入框
    showInput(row) {
      row.inputVisible = true;
      // $nextTick:页面上的元素重新渲染后，才会执行回调函数的代码
      this.$nextTick((_) => {
        // 让输入框自动获取焦点
        // 第一个ref拿到el-input，第二个ref从el-input身上拿到原生DOM节点
        this.$refs.saveTagInput.$refs.input.focus();
      });
    },
```

###### （4）添加参数的属性值

判断输入是否有效---》属性值更新到对象---》重置---》发送请求更新到数据库---》验证请求是否成功---如果请求成功，刷新参数表格并关闭输入框

```
 // 文本框失去焦点或按下enter都会触发，为参数添加tag
    async handleInputConfirm(row) {
      // 判断输入框的内容是否有效，而不是空格
      if (row.inputValue.trim().length === 0) {
        row.inputValue = "";
        row.inputVisible = false;
        return;
      }
      // 如果没有return则做其他的处理
      // 将输入内容添加，属性值更新到对象
      row.attr_vals.push(row.inputValue.trim());
      // 重置，为这一行下一次添加准备
      row.inputValue = "";
      row.inputVisible = false;
      // 需要发送请求保存这一次操作
      const { data: res } = await this.$http.put(
        `categories//${this.cateId}/attributes/${row.attr_id}`,
        {
          attr_name: row.attr_name,
          attr_sel: this.activeName,
          attr_vals: row.attr_vals,
        }
      );
      if (res.meta.status !== 200)
        return this.$message.error("添加参数的属性值失败");
      this.$message.success(res.meta.msg);
      this.handleChange();
    },
```

###### （5）删除参数的属性值

```
 // 删除参数的属性值
    async handleClose(row, i) {
      row.attr_vals.splice(i, 1);
      // 需要发送请求保存这一次操作
      saveAttr_vals(row);
    },
```

#### 3、商品列表

#### （1）创建分类参数git分支

创建本地仓库---》码云新创同样的仓库   git checkout -b --->git push -u origin

#### （2）点击分类参数进行路由跳转

#### （3）绘制基本界面

面包屑导航区---》卡片区域（搜索框及添加按钮）

#### （4）获取商品列表数据

#### （5）渲染商品列表数据---table区域

##### 1、将时间戳转化为时间

注册全局时间过滤器---在作用域卡槽处理数据

```
Vue.filter("dataFormat", function (originVal) {
  const data = new Date(originVal)
  const y = data.getFullYear()
  const m = (data.getMonth() + 1 + '').padStart(2, "0")
  const d = (data.getDate() + '').padStart(2, "0")
  const h = (data.getHours() + '').padStart(2, "0")
  const mm = (data.getMinutes() + '').padStart(2, "0")
  const ss = (data.getSeconds() + '').padStart(2, "0")
  return `${y}-${m}-${d} ${h}:${mm}:${ss}`
})
```

```
  </el-table-column>
        <el-table-column label="创建时间" width="160px">
          <template v-slot="scope">
            {{ scope.row.add_time | dataFormat }}
          </template>
        </el-table-column>
```

##### 2、删除按钮

##### 3、编辑按钮

#### （6）搜索框

输入框输入内容---点击搜索按钮、回车搜索---点击删除，显示所有数据

#### （7）分页区域

#### （8）添加商品按钮

##### 1、点击按钮-路由跳转到添加商品界面

##### 注意

路由跳转指向的组件是home组件的子组件，只有这样点进添加商品界面后，依然可以随意点击跳转其他界面

##### 2、绘制基本界面

面包屑---卡片区域

##### 3、卡片区域

##### （1）alert区域

**Alert 警告**：用于页面中展示重要的提示信息。

**Attributes**

| 参数     | 说明       | 类型    | 可选值 | 默认值 |
| :------- | :--------- | :------ | :----- | :----- |
| title    | 标题       | string  | —      | —      |
| closable | 是否可关闭 | boolean | —      | true   |

关闭  删除按钮

![image-20220417002146005](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220417002146005.png)

##### （2）step步骤条区域

**[¶](https://element.eleme.cn/#/zh-CN/component/steps#steps-bu-zou-tiao)Steps 步骤条**：引导用户按照流程完成任务的分步导航条，可根据实际应用场景设定步骤，步骤不得少于 2 步。

**Steps Attributes**

| 参数          | 说明                                               | 类型            | 可选值                                    | 默认值 |
| :------------ | :------------------------------------------------- | :-------------- | :---------------------------------------- | :----- |
| space         | 每个 step 的间距，不填写将自适应间距。支持百分比。 | number / string | —                                         | —      |
| active        | 设置当前激活步骤                                   | number          | —                                         | 0      |
| finish-status | 设置结束步骤的状态                                 | string          | wait / process / finish / error / success | finish |
| align-center  | 进行居中对齐                                       | boolean         | -                                         | false  |

##### 注意

step的active指向的值为number类型，而tab页签的 v-model指向的值为数组类型，由于要与tab页签切换同步，两者之间指向的数据对象相同，所以使用时需要将数组转换为number，操作如下：

```
     <!-- 进度条 -->
      <el-steps
        :space="200"
        :active="activeIndex - 0"
        finish-status="success"
        align-center
      >
        <el-step title="基本信息"></el-step>
        <el-step title="商品参数"></el-step>
        <el-step title="商品属性"></el-step>
        <el-step title="商品图片"></el-step>
        <el-step title="商品内容"></el-step>
        <el-step title="完成"></el-step>
      </el-steps>
```



##### （3）form---tab栏区域

##### 注意

用户输入的数据全部要收集起来发送请求添加商品，所以tab嵌套在form表单里

**[¶](https://element.eleme.cn/#/zh-CN/component/tabs#tabs-biao-qian-ye)Tabs 标签页**：分隔内容上有关联但属于不同类别的数据集合。

**Tabs Attributes**

| 参数            | 说明                                                         | 类型                                | 可选值                | 默认值              |
| :-------------- | :----------------------------------------------------------- | :---------------------------------- | :-------------------- | :------------------ |
| value / v-model | 绑定值，选中选项卡的 name                                    | string                              | —                     | 第一个选项卡的 name |
| tab-position    | 选项卡所在位置                                               | string                              | top/right/bottom/left | top                 |
| before-leave    | 切换标签之前的钩子，若返回 false 或者返回 Promise 且被 reject，则阻止切换。 | Function(activeName, oldActiveName) | —                     | —                   |

**Tabs Events**

| 事件名称  | 说明             | 回调参数              |
| :-------- | :--------------- | :-------------------- |
| tab-click | tab 被选中时触发 | 被选中的标签 tab 实例 |

##### 注意

el-tabs里只能嵌套el-tab-pane，el-tab-pane里可以嵌套任何

![image-20220417004100362](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220417004100362.png)

###### 1、基本信息

el-tab-pane嵌套el-form-item---el-input和级联选择器

###### （1）el-form-item---el-input

###### 注意

数据对象与验证规则对象  它们之间的名字与api文档里必须相同

###### （2）级联选择器

获取商品分类列表---级联选择器渲染---保存用户选择

![image-20220417004858357](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220417004858357.png)

###### 2、商品参数

将请求的数据以空格分隔，通过v-for和tag渲染

![image-20220417005208349](C:\Users\ydy\AppData\Roaming\Typora\typora-user-images\image-20220417005208349.png)

###### 3、商品属性

将请求的数据以空格分隔，通过v-for和tag渲染

###### 4、商品图片

###### 5、商品内容
